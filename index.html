<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weekly Credit Calculator</title>
  <link rel="manifest" href="manifest.json">
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f4f4f4;
    }
    .container {
      max-width: 500px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    h2 {
      text-align: center;
    }
    label {
      display: block;
      margin-top: 15px;
    }
    input[type="number"] {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    input[type="checkbox"] {
      margin-top: 10px;
      margin-right: 10px;
    }
    .output {
      margin-top: 20px;
      padding: 10px;
      background: #eef;
      border-radius: 6px;
    }
    .warning {
      background: #ffeeba;
      padding: 10px;
      border-radius: 6px;
      margin-top: 10px;
      border: 1px solid #f0ad4e;
    }
    .plan-buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Weekly Credit Calculator</h2>
    <label for="totalCredits">How many credits do you need to finish?</label>
    <input type="number" id="totalCredits" min="1" max="100" required>

    <label for="startWeek">What week are you starting from? (1â€“52)</label>
    <input type="number" id="startWeek" min="1" max="52" value="1">

    <label for="endWeek">Which week do you want to finish by? (1â€“52)</label>
    <input type="number" id="endWeek" min="1" max="52" value="46">

    <label><input type="checkbox" id="skipWinter">I won't be working during winter break.</label>
    <label><input type="checkbox" id="skipThanksgiving">I won't be working during Thanksgiving week.</label>
    <label><input type="checkbox" id="skipSpring">I won't be working during Spring week.</label>

    <button onclick="calculateCredits()" style="margin-top: 20px; width: 100%; padding: 10px;">Calculate</button>

    <div class="output" id="result"></div>

    <div class="plan-buttons" id="planButtons" style="display: none;">
      <button onclick="generatePlan('A')">ðŸŸ¢ Open Plan A</button>
      <button onclick="generatePlan('B')">ðŸŸ¡ Open Plan B</button>
      <button onclick="generatePlan('C')">ðŸ”µ Open Plan C</button>
      <button onclick="generatePlan('D')">ðŸ”´ Open Plan D</button>
    </div>
  </div>

  <script>
    const dateRanges = [
      "", "July 1â€“4", "July 7â€“11", "July 14â€“18", "July 21â€“25", "July 28â€“Aug 1",
      "Aug 4â€“8", "Aug 11â€“15", "Aug 18â€“22", "Aug 25â€“29", "Sept 1â€“5", "Sept 8â€“12",
      "Sept 15â€“19", "Sept 22â€“26", "Sept 29â€“Oct 3", "Oct 6â€“10", "Oct 13â€“17", "Oct 20â€“24",
      "Oct 27â€“31", "Nov 3â€“7", "Nov 10â€“14", "Nov 17â€“21", "Nov 24â€“28 (Thanksgiving Week)", "Dec 1â€“5",
      "Dec 8â€“12", "Dec 15â€“19", "Dec 22â€“26 (Winter Break)", "Dec 29â€“Jan 2 (Winter Break)", "Jan 5â€“9", "Jan 12â€“16",
      "Jan 19â€“23", "Jan 26â€“30", "Feb 2â€“6", "Feb 9â€“13", "Feb 16â€“20", "Feb 23â€“27",
      "Mar 2â€“6", "Mar 9â€“13", "Mar 16â€“20", "Mar 23â€“27", "Mar 30â€“Apr 3", "Apr 6â€“10",
      "Apr 13â€“17", "Apr 20â€“24", "Apr 27â€“May 1", "May 4â€“8", "May 11â€“15", "May 18â€“22",
      "May 25â€“29", "June 1â€“5", "June 8â€“12", "June 15â€“19", "June 22â€“26", "June 29â€“30"
    ];

    const holidayWeeks = {
      thanksgiving: 22,
      winter: [27, 28],
      spring: 41
    };

    let storedPlan = {};

    function calculateCredits() {
      const totalCredits = parseInt(document.getElementById("totalCredits").value);
      const startWeek = parseInt(document.getElementById("startWeek").value);
      const endWeek = parseInt(document.getElementById("endWeek").value);

      let skipWeeks = [];
      if (document.getElementById("skipThanksgiving").checked) skipWeeks.push(holidayWeeks.thanksgiving);
      if (document.getElementById("skipWinter").checked) skipWeeks.push(...holidayWeeks.winter);
      if (document.getElementById("skipSpring").checked) skipWeeks.push(holidayWeeks.spring);

      const fullWeekList = [];
      for (let i = startWeek; i <= endWeek; i++) {
        fullWeekList.push(skipWeeks.includes(i) ? 0 : 1);
      }

      const availableWeeks = fullWeekList.reduce((acc, curr) => acc + curr, 0);
      const weeklyAvg = (totalCredits / availableWeeks).toFixed(2);

      let resultText = `
        <p><strong>Credits Needed:</strong> ${totalCredits}</p>
        <p><strong>Weeks Remaining (excluding breaks):</strong> ${availableWeeks}</p>
        <p><strong>Average Credits per Week:</strong> ${weeklyAvg}</p>
        <p><strong>Note:</strong> Weeks marked as breaks will be skipped in the planner.</p>
      `;

      document.getElementById("result").innerHTML = resultText;
      document.getElementById("planButtons").style.display = "flex";
      storedPlan = { totalCredits, fullWeekList, startWeek };
    }

    function generatePlan(type) {
      const { totalCredits, fullWeekList, startWeek } = storedPlan;
      const validWeeks = fullWeekList.map((active, index) => active ? index + startWeek : null).filter(x => x);

      let creditPattern = [];
      if (type === 'A') creditPattern = Array(Math.ceil(totalCredits / 2)).fill(2);
      if (type === 'B') creditPattern = Array(Math.floor(totalCredits / 3)).fill(3).concat(totalCredits % 3 ? [totalCredits % 3] : []);
      if (type === 'C') creditPattern = Array(validWeeks.length - Math.floor(validWeeks.length / 3)).fill(2).concat(Array(Math.floor(validWeeks.length / 3)).fill(1));
      if (type === 'D') {
        creditPattern = Array(8).fill(3);
        let remaining = totalCredits - 24;
        while (remaining > 0) {
          creditPattern.push(remaining >= 4 ? 4 : remaining);
          remaining -= 4;
        }
      }

      const html = `
        <html><head><title>Plan ${type}</title><style>
          body { font-family: Arial; padding: 20px; }
          table { border-collapse: collapse; width: 100%; }
          td, th { border: 1px solid #ccc; padding: 8px; text-align: center; }
          input[type='checkbox'] { transform: scale(1.2); margin-right: 6px; }
          .credit-cell { display: flex; align-items: center; gap: 6px; }
        </style></head><body>
        <h2>Credit Tracker â€“ Plan ${type}</h2>
        <table><tr><th>Week</th><th>Date Range</th><th>Credits</th><th colspan="4">Packets</th></tr>
        ${fullWeekList.map((active, i) => {
          const weekNum = startWeek + i;
          const credits = active ? (creditPattern.shift() || 0) : 0;
          const row = `<td>${weekNum}</td><td>${dateRanges[weekNum]}</td><td>${credits}</td>`;
          const cells = Array(4).fill(`<td><div class="credit-cell"><input type="checkbox" /> ________</div></td>`).join('');
          return `<tr>${row}${cells}</tr>`;
        }).join('')}
        </table></body></html>
      `;

      const newTab = window.open();
      newTab.document.write(html);
      newTab.document.close();
    }
  </script>
</body>
</html>
